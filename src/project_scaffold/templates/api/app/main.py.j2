"""{{ project_name }} API"""

from contextlib import asynccontextmanager

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
{% if frontend_type == "htmx" %}
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates
{% endif %}
from app.config import settings
from app.database import engine
from app.routers import health, users
{% if frontend_type == "htmx" %}
from app.routers import pages
{% endif %}
{% if include_auth %}
from app.auth import routes as auth_routes
{% endif %}


@asynccontextmanager
async def lifespan(app: FastAPI):
    yield
    await engine.dispose()


app = FastAPI(
    title="{{ project_name }}",
    description="{{ description }}",
    version="0.1.0",
    lifespan=lifespan,
)

app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.cors_origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
{% if frontend_type == "htmx" %}
app.mount("/static", StaticFiles(directory="app/static"), name="static")
{% endif %}
app.include_router(health.router, tags=["health"])
app.include_router(users.router, prefix="/api/users", tags=["users"])
{% if frontend_type == "htmx" %}
app.include_router(pages.router, tags=["pages"])
{% endif %}
{% if include_auth %}
app.include_router(auth_routes.router, prefix="/api/auth", tags=["auth"])
{% endif %}
